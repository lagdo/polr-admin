function esc_selector(a){return a.replace(/(:|\.|\[|\]|,)/g,"\\$1")}jQuery.fn.clearForm=function(){return $(this).find("input").not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected"),this};var polr={home:{},stats:{}};!function(a){function e(a){$("#tips").html(a)}function t(a){switch(a){case 1:e("Create an account to keep track of your links");break;case 2:e('Did you know you can change the URL ending by clicking on "Link Options"?'),i=1}}a.datatables={},a.jaxon=null,a.initTables=function(){var e={autoWidth:!1,processing:!0,serverSide:!0,drawCallback:function(){}};$("#admin_users_table").length&&(a.datatables.admin_users_table=$("#admin_users_table").DataTable($.extend({ajax:function(e,t,n){a.jaxon={callback:t,settings:n},Lagdo.Polr.Admin.App.User.getUsers(e),a.jaxon=null},columns:[{className:"wrap-text",data:"username",name:"username"},{className:"wrap-text",data:"email",name:"email"},{data:"created_at",name:"created_at"},{data:"toggle_active",name:"toggle_active",orderable:!1,searchable:!1},{data:"api_action",name:"api_action",orderable:!1,searchable:!1},{data:"change_role",name:"change_role",orderable:!1,searchable:!1},{data:"delete",name:"delete",orderable:!1,searchable:!1}]},e))),$("#admin_links_table").length&&(a.datatables.admin_links_table=$("#admin_links_table").DataTable($.extend({ajax:function(e,t,n){a.jaxon={callback:t,settings:n},Lagdo.Polr.Admin.App.Link.getAdminLinks(e),a.jaxon=null},columns:[{className:"wrap-text",data:"short_url",name:"short_url"},{className:"wrap-text",data:"long_url",name:"long_url"},{data:"clicks",name:"clicks"},{data:"created_at",name:"created_at"},{data:"creator",name:"creator"},{data:"disable",name:"disable",orderable:!1,searchable:!1},{data:"delete",name:"delete",orderable:!1,searchable:!1}]},e))),a.datatables.user_links_table=$("#user_links_table").DataTable($.extend({ajax:function(e,t,n){a.jaxon={callback:t,settings:n},Lagdo.Polr.Admin.App.Link.getUserLinks(e),a.jaxon=null},columns:[{className:"wrap-text",data:"short_url",name:"short_url"},{className:"wrap-text",data:"long_url",name:"long_url"},{data:"clicks",name:"clicks"},{data:"created_at",name:"created_at"}]},e))},a.reloadLinkTables=function(){"admin_links_table"in a.datatables&&a.datatables.admin_links_table.ajax.reload(null,!1),a.datatables.user_links_table.ajax.reload(null,!1)},a.reloadUserTables=function(){a.datatables.admin_users_table.ajax.reload(null,!1)},a.init=function(){var e=$("#show-link-options");$("#options").hide();var n=0;e.click(function(){0===n?($("#options").slideDown(),n=1):($("#options").slideUp(),n=0)}),min=1,max=2;var r=Math.floor(Math.random()*(max-min+1))+min;t(r);setInterval(function(){t(r),r++},8e3);$(".admin-nav a").click(function(a){a.preventDefault(),$(this).tab("show")}),$(".new-user-fields").hide(),a.initTables()}}(polr.home);var parseInputDate=function(a){return moment(a)};!function(a){a.short_url="",a.requestCallbacks={timers:[],onRequest:function(){$("#stats-buttons .btn-refresh-stats").prepend('<i class="fa fa-spinner fa-spin" />')},onFailure:function(){$("#stats-buttons .btn-refresh-stats i").remove()},onSuccess:function(){$("#stats-buttons .btn-refresh-stats i").remove()}},a.populateEmptyDayData=function(){var e=moment(datePickerRightBound).diff(moment(datePickerLeftBound),"days"),t=moment(datePickerLeftBound),n={};_.each(a.dayData,function(a){var e=a.x;n[e]=!0}),_.each(_.range(0,e),function(){var e=t.format("YYYY-MM-DD");e in n||a.dayData.push({x:e,y:0}),t.add(1,"day")}),a.dayData=_.sortBy(a.dayData,["x"])},a.initDayChart=function(){var e=$("#dayChart");a.populateEmptyDayData(),a.dayChart=new Chart(e,{type:"line",data:{datasets:[{label:"Clicks",data:a.dayData,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)"}]},options:{scales:{xAxes:[{type:"time",time:{unit:"day"}}],yAxes:[{ticks:{min:0}}]}}})},a.initRefererChart=function(){var e=$("#refererChart"),t=[],n=["#003559","#162955","#2E4272","#4F628E","#7887AB","#b9d6f2"],r=[];_.each(a.refererData,function(a){if(t.length>6)return t[6]="Other",r[6]+=a.clicks,void(n[6]="brown");t.push(a.label),r.push(a.clicks)}),a.refererChart=new Chart(e,{type:"pie",data:{labels:t,datasets:[{data:r,backgroundColor:n}]}}),$("#refererTable").DataTable()},a.initCountryChart=function(){var e={};_.each(a.countryData,function(a){e[a.label]=a.clicks}),$("#mapChart").vectorMap({map:"world_mill",series:{regions:[{values:e,scale:["#C8EEFF","#0071A4"],normalizeFunction:"polynomial"}]},onRegionTipShow:function(a,t,n){t.html(t.html()+" ("+(e[n]||0)+")")}})},a.initDatePickers=function(){var a=$("#left-bound-picker"),e=$("#right-bound-picker"),t={showTodayButton:!0,format:"YYYY-MM-DD HH:mm"};a.datetimepicker(t),e.datetimepicker(t),a.data("DateTimePicker").parseInputDate(parseInputDate),e.data("DateTimePicker").parseInputDate(parseInputDate),a.data("DateTimePicker").date(datePickerLeftBound,Date,moment,null),e.data("DateTimePicker").date(datePickerRightBound,Date,moment,null)},a.initData=function(a,e,t,n,r){dayData=a,refererData=e,countryData=t,datePickerLeftBound=n,datePickerRightBound=r},a.initCharts=function(){a.dayChart=null,a.refererChart=null,a.countryChart=null,a.dayData=dayData,a.refererData=refererData,a.countryData=countryData,a.initDayChart(),a.initRefererChart(),a.initCountryChart()},a.init=function(){a.initCharts(),a.initDatePickers()}}(polr.stats);